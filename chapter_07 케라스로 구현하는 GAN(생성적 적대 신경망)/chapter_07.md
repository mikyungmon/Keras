# Chapter 07 #

🔎 생성적 적대 신경망(GAN)이란 ? 

  - 경쟁하여 최적화를 수행하는 생성형 신경망이다.
  
  - GAN 내부의 두 신경망이 상호 경쟁하면서 학습한다.
  
  - 두 신경망 중 하나는 **생성망**이고 다른 하나는 **판별망**이다.

▶ 해당 장에서 다루는 내용은 다음과 같다. 
  
  1) GAN의 원리
  2) 완전 연결 계층을 이용한 GAN 구현 : 확률분포
  3) 합성곱 계층을 이용한 GAN 구현 : MNIST

## 7.1 GAN의 원리 ##

GAN은 **경쟁적 학습 방법을 이용하는 생성형 인공지능**이다. 이 절에서는 GAN의 목적과 개념, 구조, GAN을 구성하는 생성망과 판별망에 대해서 배운다.

### 7.1.1 GAN의 목적과 개념 ###

GAN은 생성형 인공지능 방식으로 **실제 데이터**와 비슷한 확률분포를 가지는 **허구 데이터**를 생성한다.

허구 데이터는 GAN에서 만들어진 데이터이기 때문에 **생성 데이터**라고도 한다.

예를 들어 GAN은 실제 데이터로 얼굴 사진을 제공하면 비슷한 확률분포를 가지는 새로운 허구 얼굴 사진을 생성한다.

반면 DNN, CNN과 같은 판별형 신경망은 데이터의 레이블을 학습하여 데이터를 판별한다.

GAN은 레이블이 없는 정보를 다루는 **비지도학습**이다.

입력 데이터는 **무작위 잡음**이고 출력 데이터는 입력 데이터보다 높은 차원으로 구성된다.

입력한 무작위 잡음은 출력 데이터와 상관이 없기 때문에 GAN은 비지도형의 생성형 신경망이다.

출력 데이터는 특정 분포도를 갖은 데이터로 가정한다. 예를 들어 필기체 숫자나 사람 얼굴 사진 등이 될 수 있다.

**학습을 마친 GAN에 새로운 무작위 잡음을 입력하면 학습한 실제 데이터와 유사한 형태의 허구 데이터를 출력한다.**

예를 들어 필기체 숫자나 사람 얼굴을 학습시키면 학습시킨 것과 비슷한 필기체 숫자나 사람 얼굴이 나온다.

잡음은 이론적으로 무한한 변위가 가능하므로 출력으로 나온 결과는 학습에 사용한 그 어떤 데이터와도 완전히 같지는 않다.

### 7.1.2 GAN의 구조 ###

![image](https://user-images.githubusercontent.com/66320010/124115061-4c09be80-daa8-11eb-9b8a-6f9ac040787f.png)

- GAN 인공지능은 경쟁적인 방법으로 학습을 수행한다. 위 그림과 같이 두 망이 복합 구성되어 있다(첫 번째는 생성망이고 다음은 판별망이다).

- 학습의 목적은 학습한 실제 데이터와 같은 확률분포를 가지는 새로운 허구 데이터를 만들도록 생성망을 학습시키는 것이다.

- 생성망이 실제 데이터와 확률 분포상 유사한 데이터를 만들려면 GAN의 학습이 잘 진행되어야 한다.

- **판별망**은 실제 데이터인지 만들어진 허구 데이터인지를 더 잘 구분하도록 학습하고, **생성망**은 학습을 통해 판별망을 더 잘 속이도록 학습한다.

### 7.1.3 GAN의 동작 원리 ###

GAN의 생성망과 판별망의 동작 원리를 알아보자.

GAN은 **생성망**과 **판별망**이라는 두 신경망이 합쳐져 구성된다. 

 ▶ 생성망은 주어진 데이터와 유사한 허구 데이터를 생성한다.
 
 ▶ 판별망은 생성망에서 전달된 데이터가 생성망에서 만든 허구 데이터인지 아니면 원래 주어진 실제 데이터인지를 구분한다.

**생성망**은 저차원 무작위 잡음을 입력받아 고차원 허구 이미지를 생성한다. 허구 이미지는 생성망이 만든 이미지이므로 생성 이미지라고도 부른다. 

실제 이미지를 학습하여 실제 이미지와 확률분포가 최대한 비슷하도록 허구 이미지를 만든다. 

💡 **이 학습 과정에서 판별망의 판단 결과를 활용하게 된다.** 생성망이 만든 허구 이미지를 판별망이 실제 이미지로 착각하도록 만드는 방향으로 생성망 학습이 이루어지기 때문이다.

**판별망**은 입력된 이미지가 실제인지 허구인지 판별한다. 문제는 실제 이미지는 변하지 않지만 허구 이미지는 생성망의 학습이 진행됨에 따라 점점 실제 이미지와 유사해진다는 점이다.

그래서 판별망은 바로 앞서 생성망에 의해 만들어진 허구 이미지들과 주어진 실제 이미지들을 판별할 수 있도록 점진적으로 학습을 진행한다. 

발전된 생성망의 결과를 허구로 판별할 수 있도록 상호 공진화하는 방식이다.

이미지 판별과 생성 시 합성곱 계층을 사용하면 GAN에서도 완전 연결 계층보다 더 효과적인 처리를 할 수 있다. 예제를 통해 두 경우 모두에 대해 알아볼 것이다.

### 7.1.3 GAN의 동작 사례 ###

GAN을 제안한 이안 굿펠로우의 논문에 제시된 예제를 활용하여 GAN이 어떻게 구현되는지 알아본다. 

다음 그림은 GAN이 입력된 확률변수를 변환시켜 원하는 확률변수로 바꾸어 출력하는 예를 보여준다.

![image](https://user-images.githubusercontent.com/66320010/124116521-ff26e780-daa9-11eb-833f-7e63b7c48b0d.png)

우선 판별망의 동작에 대해 알아보자.

![image](https://user-images.githubusercontent.com/66320010/124116904-752b4e80-daaa-11eb-9b11-8d015281fd2b.png)

- 판별망은 무작위 잡음 벡터 z를 입력받아 생성하는 생성망의 결과를 판별하는 신경망이다. 

- 일반적으로 판별망은 개별 이미지가 무엇인지 판별하는 데 사용된다.

- 그렇지만 GAN의 판별망은 **개별 이미지가 아닌 이미지의 확률분포를 판별한다.**

- 판별망은 실제 데이터와 생성망이 만든 허구 데이터의 확률분포 차이를 판별하도록 학습된다.

- 목표 데이터를 1로 판별하는 과정은 위 그림의 a 흐름도와 같다. 먼저 실제 데이터의 일부를 판별망에 입력한다. 실제 데이터 전체에서 일부를 가져오는 방식은 배치처리와 같이 이루어진다.

- 미분 가능한 판별 함수 D가 실제 데이터의 샘플을 1로 판별할 수 있도록 학습시킨다. 판별 함수 D는 정확도가 높은 판별을 위해 신경망으로 구성한다.

- 생성 데이터를 0으로 판별하는 단계를 위 그림의 b 흐름도와 같다. GAN은 실제 데이터의 확률분포와 다른 임의의 확률 분포를 가진 무작위 잡음을 만든다.

- 만들어진 무작위 잡음을 미분 가능한 생성 함수 G에 통과시킨다.

- 여기서도 복잡한 확률분포를 변환하기 위해 생성 함수 G를 신경망으로 구성한다. 

- 다음으로 생성 함수 G가 생성한 데이터를 추출하고 추출된 데이터를 목표 데이터와 동일하게 판별 함수 D에 통과시킨다. 

- 판별 함수는 실제 데이터 판별에 사용한 신경망을 한 번 더 사용한다. 판별값은 거짓 즉 0이 되어야한다.

📍 판별값은 실제 데이터를 입력하면 1, 생성 데이터를 입력하면 0이어야 한다.
 
이 판별은 학습 과정이 진행되면서 점점 명확해진다. 초기 생성망은 임의의 형태로 구성된다고 가정한다. 

**판별망을 학습시킬 때 생성망까지 학습되면 안되므로 생성망의 가중치는 학습이 되지 않도록 고정해야한다.**

이제 판별에 들어가는 입력은 실제 데이터에서 추출한 배치 데이터와 생성망에서 만든 허구 데이터로 구성된다. 

그리고 목표 출력값은 각 데이터 군별로 1과 0 에 해당한다.

이런 조건으로 판별망 학습을 진행한다. **단, 판별망 학습 이후에 생성망이 또다시 진화되기 때문에 순환적으로 계속 판별망을 학습시키는 점은 기존의 일반 판별망과 다르다.** 이는 뒤에서 좀 더 자세히 다룬다.

판별망 학습이 끝나면 생성망을 학습할 차례이다. 우선 생성망의 결과가 판별망으로 들어가도록 가상 신경망 모델을 구성한다. 이를 '생성망 최적화를 위한 학습용 생성함수 GD'또는 '학습용 생성망'이라고 한다.

주의할 점은 이 학습용 생성망은 새로운 신경망이 아니라 기존의 생성망과 판별망이 합쳐진 가상 생성망이라는 점이다.

또한 이 학습용 생성망 모델에서 판별망 부분은 학습이 되지 않도록 가중치를 고정한다. 이렇게 하면 학습용 생성망에서 판별망은 무작위 잡음 벡터 z로부터 생성된 허구 이미지가 얼마나 실제 이미지와 유사한지 판별한 결과를 내게 된다.

그리고 이 판별한 결과가 모든 실제가 되도록 생성망을 학습한다. 허구인지 실제인지 구분한 결과는 일반적인 분류망에서와 마찬가지로 교차 엔트로피로 표현된다.

학습용 생성망의 학습을 통해 생성망은 한 단계 진화한다.

진화된 생성망은 또다시 무작위 입력 벡터 z에 대해 이미지 변환을 수행한다.

이렇게 판별망과 생성망의 학습이 한 번씩 진행되면 GAN전체 학습이 한 번 수행된 것이다. 

이 전체 최적화와 각 망들의 부분 최적화를 병행하면서 GAN은 점점 목표한 최적 단계로 발전해나간다.

결국 임의의 정규분포 입력의 분포를 조절하여 실제 이미지를 생성하도록 발전한다.

최적화가 완전히 끝나면 이론적으로는 생성망의 결과와 실제 이미지를 판별망이 구분하지 못하게 된다.

이런 경지를 달성하려면 각 생성망과 판별망이 최적으로 구성되고 둘의 밸런스도 맞아야한다.

## 7.2 확률분포 생성을 위한 완전 연결 계층 GAN 구현 ## 

- GAN을 처음 제안한 논문에 게재된 예제를 구현한다. 이 예제는 GAN으로 정규분포를 생성한다. 

- 생성에 사용하는 무작위 벡터 z는 균등분포 확률신호인데 출력은 정규분포 확률 신호이다.

다음과 같은 순서로 진행된다.

1) 패키지 임포트
2) 코드 수행과 결과 보기
3) 머신 구현하기
4) 데이터 관리 클래스
5) GAN 모델링

### 7.2.1 패키지 임포트 ###











